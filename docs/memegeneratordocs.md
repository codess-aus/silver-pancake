# Silver Pancake - AI Meme Generator Documentation

## 🎯 Project Overview

**Silver Pancake** is an AI-powered meme generator that uses Azure OpenAI's gpt-image-1 model to create visual memes. The application generates images based on user-provided topics and moods, with simple hardcoded text overlays.

### ⚠️ Current Implementation Note
**This app ONLY uses image generation (gpt-image-1).** There is no AI text generation model deployed. Text overlays on memes are selected from predefined templates, not generated by AI. The Content Safety service is configured but not actively used in the current image generation flow.

### Key Features
- **Visual Meme Generation**: AI-generated images using Azure OpenAI gpt-image-1 model
- **Hardcoded Text Overlays**: Simple text templates based on topic and mood (not AI-generated)
- **Content Safety**: Automated moderation for workplace-appropriate content (available but not actively used)
- **User Feedback**: Built-in feedback mechanism for continuous improvement
- **Responsive Design**: Works on desktop and mobile devices

---

## 🏗️ Architecture Overview

### High-Level Architecture

```
┌─────────────────┐
│   React Frontend│
│   (Port 3000)   │
└────────┬────────┘
         │ HTTP/REST
         ↓
┌─────────────────┐
│  FastAPI Backend│
│   (Port 8000)   │
│  (Hardcoded     │
│   Text Templates│
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│   Azure OpenAI  │
│   gpt-image-1   │
│ (Image Gen Only)│
└─────────────────┘

Note: Azure Content Safety is configured but not used in the current image generation flow
```

### Technology Stack

**Frontend**
- React 18.2.0
- Axios for API calls
- Emotion for styling
- Create React App (Webpack bundler)

**Backend**
- Python 3.12+
- FastAPI 0.110.0
- Uvicorn (ASGI server)
- Pydantic for data validation
- Azure SDK libraries

**Cloud Services**
- Azure OpenAI Service (gpt-image-1 deployment for image generation only)
- Azure Content Safety API (configured but not actively used in image generation flow)
- Optional: Azure Application Insights

---

## 📁 Project Structure

```
silver-pancake/
├── backend/                    # Python FastAPI backend
│   ├── services/              # Business logic layer
│   │   ├── openai_service.py         # Text generation
│   │   ├── enhanced_meme_service.py  # Visual meme generation
│   │   └── content_safety_service.py # Content moderation
│   ├── tests/                 # Backend tests
│   ├── config.py             # Configuration management
│   ├── main.py               # FastAPI application entry point
│   ├── requirements.txt      # Python dependencies
│   └── .env.example          # Environment variables template
│
├── frontend/                  # React frontend
│   ├── src/
│   │   ├── components/       # React components
│   │   │   ├── MemeGenerator.js    # Input form
│   │   │   ├── MemeDisplay.js      # Meme display
│   │   │   └── FeedbackButton.js   # Feedback widget
│   │   ├── App.js           # Main application
│   │   └── index.js         # React entry point
│   ├── public/              # Static assets
│   └── package.json         # NPM dependencies
│
├── docs/                     # Documentation
├── evaluations/             # AI evaluation scripts
└── README.md               # Project readme
```

---

## 🔧 Setup Instructions

### Prerequisites
- Node.js 18+ and npm
- Python 3.12+
- Azure subscription with:
  - Azure OpenAI Service access
  - Azure Content Safety resource

### Backend Setup

1. **Clone and navigate to backend**
   ```bash
   cd backend
   ```

2. **Create virtual environment**
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. **Install dependencies**
   ```bash
   pip install -r requirements.txt
   ```

4. **Configure environment variables**
   ```bash
   cp .env.example .env
   # Edit .env with your Azure credentials
   ```

   Required variables:
   ```
   AZURE_OPENAI_ENDPOINT=https://your-resource.cognitiveservices.azure.com/
   AZURE_OPENAI_API_KEY=your-api-key
   AZURE_OPENAI_IMAGE_DEPLOYMENT_NAME=gpt-image-1
   AZURE_OPENAI_API_VERSION=2025-04-01-preview
   
   # Optional - Content Safety (configured but not currently used)
   AZURE_CONTENT_SAFETY_ENDPOINT=https://your-resource.cognitiveservices.azure.com/
   AZURE_CONTENT_SAFETY_API_KEY=your-api-key
   
   # Note: AZURE_OPENAI_TEXT_DEPLOYMENT_NAME is not needed as no text model is deployed
   ```

5. **Run the backend server**
   ```bash
   uvicorn main:app --reload --port 8000
   ```

   The API will be available at `http://localhost:8000`
   Interactive docs at `http://localhost:8000/docs`

### Frontend Setup

1. **Navigate to frontend**
   ```bash
   cd frontend
   ```

2. **Install dependencies**
   ```bash
   npm install
   ```

3. **Start development server**
   ```bash
   npm start
   ```

   The app will open at `http://localhost:3000`

---

## 🎨 Component Architecture

### Backend Services

#### 1. **OpenAIService** (`services/openai_service.py`)
- **Purpose**: Originally designed for text generation, but currently NOT USED
- **Status**: No text generation model is deployed
- **Note**: This service exists in the codebase but is not active in the current implementation

#### 2. **EnhancedMemeService** (`services/enhanced_meme_service.py`)
- **Purpose**: Generates visual memes with images and hardcoded text
- **Methods**:
  - `generate_visual_meme()`: Creates AI-generated meme images using gpt-image-1
  - `generate_text_meme()`: Returns hardcoded text templates (no AI text generation)
  - `generate_complete_meme()`: Combines image generation with hardcoded text
- **Key Implementation Details**:
  - Uses Azure OpenAI gpt-image-1 for image generation only
  - Returns base64-encoded images
  - Constructs detailed prompts for meme-appropriate images
  - Text is selected from predefined templates, not AI-generated

#### 3. **ContentSafetyService** (`services/content_safety_service.py`)
- **Purpose**: Moderates content for workplace appropriateness
- **Status**: Configured but NOT actively used in current image generation flow
- **Methods**:
  - `analyze_text()`: Checks text for safety violations
- **Safety Categories**:
  - Hate speech
  - Sexual content
  - Violence
  - Self-harm
- **Threshold**: Severity level 2 (configurable)
- **Note**: Was designed for text moderation but images are generated without content safety checks currently

### Frontend Components

#### 1. **MemeGenerator** (`components/MemeGenerator.js`)
- **Purpose**: User input form for meme generation
- **Features**:
  - Topic input field
  - Mood selection (funny, sarcastic, wholesome, etc.)
  - Loading states
  - Error handling
- **API Integration**: POST to `/api/generate-visual-meme`

#### 2. **MemeDisplay** (`components/MemeDisplay.js`)
- **Purpose**: Displays generated memes
- **Features**:
  - Text meme rendering with styled overlays
  - Visual meme display (base64 images)
  - Responsive layout
  - Download functionality

#### 3. **FeedbackButton** (`components/FeedbackButton.js`)
- **Purpose**: Collects user feedback
- **Features**:
  - Thumbs up/down buttons
  - Optional comment input
  - Feedback submission to backend

---

## 🔌 API Reference

### Base URL
- Development: `http://localhost:8000`
- Production: (Configure your production URL)

### Endpoints

#### 1. **Generate Text Meme (NOT AVAILABLE)**
```http
POST /api/generate-meme
Content-Type: application/json

{
  "topic": "monday meetings",
  "mood": "funny"
}
```

**Response:**
```json
{
  "success": false,
  "message": "Text-based memes are not available. Please use /api/generate-visual-meme for image-based memes.",
  "redirect": "/api/generate-visual-meme",
  "available_endpoints": ["/api/generate-visual-meme"],
  "note": "Only visual memes are supported with the current gpt-image-1 deployment."
}
```

**Note**: This endpoint is disabled as no text generation model is deployed.

#### 2. **Generate Visual Meme (PRIMARY ENDPOINT)**
```http
POST /api/generate-visual-meme
Content-Type: application/json

{
  "topic": "debugging code",
  "mood": "sarcastic",
  "include_text": true,
  "include_image": true
}
```

**Response:**
```json
{
  "success": true,
  "meme_components": {
    "visual": {
      "image_url": "data:image/png;base64,...",
      "prompt": "...",
      "model": "gpt-image-1"
    },
    "text": {
      "text": "...",
      "top_text": "...",
      "bottom_text": "..."
    }
  },
  "message": "Visual meme generated successfully! 🎨"
}
```

#### 3. **Submit Feedback**
```http
POST /api/feedback
Content-Type: application/json

{
  "rating": 1,
  "comment": "Great meme!",
  "meme_topic": "debugging code"
}
```

#### 4. **Health Check**
```http
GET /health
```

**Response:**
```json
{
  "status": "healthy",
  "environment": "development"
}
```

---

## 💻 Coding Standards

### Python (Backend)

#### Style Guide
- **Follow PEP 8** for code formatting
- **Line length**: Maximum 100 characters
- **Imports**: Group stdlib, third-party, and local imports separately
- **Type hints**: Use type annotations for all functions

#### Documentation Standards
```python
def generate_meme(topic: str, mood: str = "funny") -> Dict[str, Any]:
    """
    Generate a meme based on topic and mood.
    
    Args:
        topic: The subject matter for the meme
        mood: The desired tone (funny, sarcastic, wholesome, etc.)
    
    Returns:
        Dict containing the generated meme and metadata
        
    Raises:
        HTTPException: If content fails safety checks or generation fails
        
    Enterprise Best Practice: Always validate inputs and handle errors gracefully.
    """
```

#### Error Handling
```python
try:
    result = await some_operation()
except SpecificException as e:
    logger.error(f"Operation failed: {str(e)}")
    raise HTTPException(status_code=500, detail="User-friendly message")
```

#### Logging Best Practices
```python
import logging

logger = logging.getLogger(__name__)

# Use appropriate log levels
logger.debug("Detailed debugging information")
logger.info("General information about execution")
logger.warning("Warning about potential issues")
logger.error("Error occurred but application continues")
logger.critical("Critical error, application may fail")
```

### JavaScript/React (Frontend)

#### Style Guide
- **ESLint**: Follow Airbnb JavaScript Style Guide
- **Component naming**: PascalCase for components
- **File naming**: Match component name (MemeGenerator.js)
- **Props destructuring**: Destructure props in function signature

#### Component Structure
```javascript
import React, { useState, useEffect } from 'react';
import PropTypes from 'prop-types';
import './ComponentName.css';

/**
 * Brief description of component purpose
 * 
 * @param {Object} props - Component props
 * @param {Function} props.onAction - Callback when action occurs
 */
function ComponentName({ onAction, initialValue }) {
  const [state, setState] = useState(initialValue);

  // Event handlers
  const handleClick = () => {
    // Implementation
  };

  // Effects
  useEffect(() => {
    // Side effects
  }, [dependencies]);

  return (
    <div className="component-name">
      {/* JSX */}
    </div>
  );
}

ComponentName.propTypes = {
  onAction: PropTypes.func.isRequired,
  initialValue: PropTypes.string
};

ComponentName.defaultProps = {
  initialValue: ''
};

export default ComponentName;
```

#### State Management
- Use `useState` for local component state
- Lift state up when shared between components
- Keep state as close as possible to where it's used

#### Error Handling
```javascript
try {
  const response = await api.generateMeme(data);
  handleSuccess(response);
} catch (error) {
  console.error('API Error:', error);
  setError(error.response?.data?.detail || 'An error occurred');
}
```

---

## 🧪 Testing Standards

### Backend Testing

#### Unit Tests (pytest)
```python
# tests/test_openai_service.py
import pytest
from services.openai_service import OpenAIService

@pytest.fixture
def openai_service():
    return OpenAIService()

async def test_generate_meme_success(openai_service):
    """Test successful meme generation."""
    result = await openai_service.generate_meme("testing", "funny")
    
    assert result is not None
    assert "meme_text" in result
    assert result["topic"] == "testing"

async def test_generate_meme_invalid_topic(openai_service):
    """Test handling of invalid topic."""
    with pytest.raises(ValueError):
        await openai_service.generate_meme("", "funny")
```

#### Running Tests
```bash
# Run all tests
pytest

# Run with coverage
pytest --cov=services --cov-report=html

# Run specific test file
pytest tests/test_openai_service.py
```

### Frontend Testing

#### Component Tests (Jest + React Testing Library)
```javascript
// MemeGenerator.test.js
import { render, screen, fireEvent } from '@testing-library/react';
import MemeGenerator from './MemeGenerator';

test('renders topic input field', () => {
  render(<MemeGenerator onMemeGenerated={jest.fn()} />);
  const input = screen.getByPlaceholderText(/enter a topic/i);
  expect(input).toBeInTheDocument();
});

test('submits form with topic', async () => {
  const mockOnGenerate = jest.fn();
  render(<MemeGenerator onMemeGenerated={mockOnGenerate} />);
  
  const input = screen.getByPlaceholderText(/enter a topic/i);
  const button = screen.getByText(/generate/i);
  
  fireEvent.change(input, { target: { value: 'testing' } });
  fireEvent.click(button);
  
  // Assert API call was made
  expect(mockOnGenerate).toHaveBeenCalled();
});
```

#### Running Tests
```bash
# Run all tests
npm test

# Run with coverage
npm test -- --coverage

# Run in watch mode
npm test -- --watch
```

---

## 🔒 Security Best Practices

### Environment Variables
- **Never commit** `.env` files to version control
- Use `.env.example` as a template
- Rotate API keys regularly
- Use different keys for development and production

### API Security
- **CORS**: Configured to only allow specific origins
- **Input Validation**: All inputs validated with Pydantic models
- **Rate Limiting**: Consider implementing rate limiting for production
- **Content Safety**: All AI-generated content is moderated

### Azure Best Practices
- Use **Managed Identity** in production (instead of API keys)
- Enable **Azure Monitor** for logging and alerting
- Use **Key Vault** for secret management
- Implement **Azure Private Link** for enhanced security

---

## 🚀 Deployment Guide

### Backend Deployment (Azure)

#### Option 1: Azure Container Apps
```bash
# Build Docker image
docker build -t silver-pancake-backend .

# Push to Azure Container Registry
az acr build --registry <your-registry> --image silver-pancake-backend:latest .

# Deploy to Container Apps
az containerapp create \
  --name silver-pancake-api \
  --resource-group <your-rg> \
  --environment <your-env> \
  --image <your-registry>.azurecr.io/silver-pancake-backend:latest \
  --target-port 8000
```

#### Option 2: Azure App Service
```bash
# Create App Service plan
az appservice plan create --name silver-pancake-plan --resource-group <your-rg> --sku B1 --is-linux

# Create web app
az webapp create --resource-group <your-rg> --plan silver-pancake-plan --name silver-pancake-api --runtime "PYTHON:3.12"

# Deploy code
az webapp deployment source config-zip --resource-group <your-rg> --name silver-pancake-api --src backend.zip
```

### Frontend Deployment

#### Build for Production
```bash
cd frontend
npm run build
```

#### Deploy to Azure Static Web Apps
```bash
# Install Azure Static Web Apps CLI
npm install -g @azure/static-web-apps-cli

# Deploy
swa deploy --app-location ./build --deployment-token <your-token>
```

### Environment Configuration
Update environment variables in Azure:
```bash
az webapp config appsettings set \
  --resource-group <your-rg> \
  --name silver-pancake-api \
  --settings \
    AZURE_OPENAI_ENDPOINT="<value>" \
    AZURE_OPENAI_API_KEY="<value>" \
    # ... other settings
```

---

## 🐛 Troubleshooting Guide

### Common Issues

#### 1. **404 Error on Image Generation**
**Symptom**: API returns 404 when generating images

**Solution**: Ensure Azure OpenAI client is initialized correctly:
```python
# ✅ CORRECT - Use azure_endpoint parameter
self.client = AzureOpenAI(
    api_key=settings.azure_openai_api_key,
    api_version=settings.azure_openai_api_version,
    azure_endpoint=settings.azure_openai_endpoint  # Not base_url!
)
```

**Why**: Azure OpenAI SDK handles URL construction internally. Manually adding `/openai/v1/` causes incorrect URLs.

#### 2. **CORS Errors**
**Symptom**: Browser blocks frontend requests to backend

**Solution**: Check CORS settings in `main.py`:
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.cors_origins_list,  # Must include frontend URL
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

#### 3. **Content Safety Rejections**
**Symptom**: Memes are frequently rejected for safety violations

**Solution**:
- Review severity thresholds in `ContentSafetyService`
- Adjust `SEVERITY_THRESHOLD` if needed (current: 2)
- Check prompts for potentially triggering keywords

#### 4. **Module Import Errors**
**Symptom**: `ModuleNotFoundError` when running backend

**Solution**:
```bash
# Set PYTHONPATH
export PYTHONPATH=/path/to/backend:$PYTHONPATH

# Or run from correct directory
cd backend
python -m uvicorn main:app --reload
```

#### 5. **Frontend Not Connecting to Backend**
**Symptom**: API calls fail from React app

**Solution**: Check `package.json` proxy setting:
```json
{
  "proxy": "http://localhost:8000"
}
```

### Debug Mode

#### Enable Verbose Logging (Backend)
```bash
# Set in .env
LOG_LEVEL=DEBUG

# Or run with environment variable
LOG_LEVEL=DEBUG uvicorn main:app --reload
```

#### Check Backend Logs
```bash
# View real-time logs
tail -f backend.log

# Search for errors
grep ERROR backend.log
```

#### Browser DevTools (Frontend)
1. Open Chrome/Firefox DevTools (F12)
2. Check Console for JavaScript errors
3. Check Network tab for failed API requests
4. Verify request/response payloads

---

## 📊 Monitoring and Observability

### Application Insights Integration

#### Backend Setup
```python
# Add to requirements.txt
opencensus-ext-azure==1.1.11

# Configure in main.py
from opencensus.ext.azure.log_exporter import AzureLogHandler

logger.addHandler(AzureLogHandler(
    connection_string=settings.applicationinsights_connection_string
))
```

#### Key Metrics to Monitor
- **Request Rate**: Requests per second to each endpoint
- **Response Time**: p50, p95, p99 latencies
- **Error Rate**: 4xx and 5xx responses
- **Azure OpenAI Usage**: Token consumption and costs
- **Content Safety Flags**: Rate of flagged content

### Logging Standards

#### Structured Logging
```python
logger.info(
    "Meme generated",
    extra={
        "topic": topic,
        "mood": mood,
        "generation_time_ms": elapsed_time,
        "content_safe": is_safe
    }
)
```

#### Log Levels Usage
- **DEBUG**: Detailed diagnostic information
- **INFO**: General informational messages
- **WARNING**: Warning messages for recoverable issues
- **ERROR**: Error messages for non-critical failures
- **CRITICAL**: Critical errors that may cause system failure

---

## 🤝 Contributing Guidelines

### Git Workflow

1. **Create a Feature Branch**
   ```bash
   git checkout -b feature/your-feature-name
   ```

2. **Make Changes**
   - Write code following coding standards
   - Add tests for new functionality
   - Update documentation

3. **Commit Changes**
   ```bash
   git add .
   git commit -m "feat: Add new meme mood option"
   ```

   **Commit Message Format**:
   - `feat:` New feature
   - `fix:` Bug fix
   - `docs:` Documentation changes
   - `style:` Code style changes (formatting)
   - `refactor:` Code refactoring
   - `test:` Adding or updating tests
   - `chore:` Maintenance tasks

4. **Push and Create PR**
   ```bash
   git push origin feature/your-feature-name
   ```

### Pull Request Process

1. **PR Title**: Clear and descriptive
2. **Description**: Explain what and why
3. **Checklist**:
   - [ ] Code follows style guidelines
   - [ ] Self-review completed
   - [ ] Tests added/updated
   - [ ] Documentation updated
   - [ ] No new warnings or errors

### Code Review Guidelines

**For Reviewers**:
- Check for security issues
- Verify error handling
- Ensure tests are adequate
- Review documentation updates
- Test locally if possible

**For Contributors**:
- Respond to feedback promptly
- Make requested changes
- Keep PR scope focused
- Rebase if needed to resolve conflicts

---

## 📚 Additional Resources

### Azure Documentation
- [Azure OpenAI Service](https://learn.microsoft.com/azure/ai-services/openai/)
- [Azure Content Safety](https://learn.microsoft.com/azure/ai-services/content-safety/)
- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [React Documentation](https://react.dev/)

### Internal Resources
- `reference.md`: API reference examples
- `keyauth.md`: Azure authentication guides
- `codesamples.md`: Code samples and patterns
- Backend README: Detailed backend setup
- Frontend README: Frontend development guide

### Support Contacts
- **Technical Issues**: [Your team's support channel]
- **Azure Support**: [Azure support link]
- **Security Issues**: [Security team contact]

---

## 🎓 Learning Path for New Team Members

### Week 1: Setup and Fundamentals
- [ ] Complete environment setup
- [ ] Run application locally
- [ ] Read architecture overview
- [ ] Explore API documentation at `/docs`
- [ ] Review code structure

### Week 2: Core Concepts
- [ ] Understand FastAPI basics
- [ ] Learn React component patterns
- [ ] Study Azure OpenAI integration
- [ ] Review content safety implementation
- [ ] Run and write tests

### Week 3: Advanced Topics
- [ ] Implement a small feature
- [ ] Add comprehensive tests
- [ ] Create PR and go through review
- [ ] Deploy to test environment
- [ ] Monitor application metrics

### Week 4: Independence
- [ ] Take on larger feature work
- [ ] Participate in code reviews
- [ ] Contribute to documentation
- [ ] Help with troubleshooting

---

## 🔄 Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2025-10-09 | Initial documentation |

---

## 📝 FAQ

**Q: Why is it called "Silver Pancake"?**
A: It's a fun, memorable name that represents the project's goal of making AI approachable and enjoyable!

**Q: Can I use other Azure OpenAI models?**
A: Currently only gpt-image-1 is deployed and used. To add text generation (like gpt-4.1), you would need to:
   1. Deploy a text model in Azure OpenAI
   2. Set `AZURE_OPENAI_TEXT_DEPLOYMENT_NAME` in `.env`
   3. Uncomment and enable the text generation endpoint in `main.py`
   4. Update the `OpenAIService` to use the text model

**Q: How much does it cost to run?**
A: Costs depend on usage. Monitor Azure OpenAI token consumption and Content Safety API calls.

**Q: Can I deploy this on other cloud providers?**
A: The backend is cloud-agnostic, but you'll need to replace Azure-specific services (OpenAI, Content Safety) with alternatives.

**Q: How do I add new meme moods?**
A: Update the mood options in `MemeGenerator.js` and adjust prompts in the backend services accordingly.

**Q: Is this production-ready?**
A: The core functionality is solid, but consider adding: rate limiting, authentication, monitoring, and load testing before production use.

---

## 📞 Getting Help

If you're stuck:

1. **Check this documentation** - Most answers are here!
2. **Review the troubleshooting guide** - Common issues and solutions
3. **Check Azure service health** - Verify services are operational
4. **Look at logs** - Backend logs often reveal the issue
5. **Ask the team** - We're here to help!

---

*Last Updated: October 9, 2025*
*Maintained by: Silver Pancake Team*
